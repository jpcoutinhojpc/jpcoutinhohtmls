<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GC</title>
  <style>
    :root {
      color-scheme: dark;
      --font-primary: "Segoe UI", "Inter", system-ui, -apple-system, sans-serif;
      --shadow: 0 20px 55px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: transparent;
      font-family: var(--font-primary);
    }

    body[data-backdrop="green"] { background: #00b140; }
    body[data-backdrop="blue"] { background: #0057e7; }
    body[data-backdrop="transparent"] { background: transparent; }

    .layer {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      pointer-events: none;
      padding: 40px;
    }

    #gcFrame {
      position: relative;
      min-width: 420px;
      width: 100%;
      max-width: 1024px;
      opacity: 0;
      transform: translateY(30px) scale(0.96);
      transition: opacity 0.4s ease, transform 0.4s ease;
      pointer-events: none;
      filter: drop-shadow(0 22px 56px rgba(0,0,0,0.48));
    }

    #gcFrame.visible { opacity: 1; transform: translateY(0) scale(1); }

    #gcFrame.anim-slide.visible { animation: slideIn 0.45s ease; }
    #gcFrame.anim-slide.hiding { animation: slideOut 0.42s ease forwards; }
    #gcFrame.anim-fade.visible { animation: fadeIn 0.4s ease; }
    #gcFrame.anim-fade.hiding { animation: fadeOut 0.35s ease forwards; }
    #gcFrame.anim-pop.visible { animation: popIn 0.45s cubic-bezier(0.16, 1, 0.3, 1); }
    #gcFrame.anim-pop.hiding { animation: popOut 0.36s ease forwards; }

    @keyframes slideIn { from { opacity: 0; transform: translateY(40px) scale(0.95);} to { opacity:1; transform: translateY(0) scale(1);} }
    @keyframes slideOut { from { opacity:1; transform: translateY(0) scale(1);} to { opacity: 0; transform: translateY(30px) scale(0.96);} }
    @keyframes fadeIn { from { opacity:0; transform: translateY(15px);} to { opacity:1; transform: translateY(0);} }
    @keyframes fadeOut { from { opacity:1; transform: translateY(0);} to { opacity:0; transform: translateY(10px);} }
    @keyframes popIn { 0% { opacity:0; transform: translateY(22px) scale(0.9);} 100% { opacity:1; transform: translateY(0) scale(1);} }
    @keyframes popOut { 0% { opacity:1; transform: translateY(0) scale(1);} 100% { opacity:0; transform: translateY(18px) scale(0.9);} }

    /* Temas */
    body[data-theme="jornalismo"] {
      --panel: rgba(18, 26, 46, 0.92);
      --panel-2: rgba(25, 35, 62, 0.92);
      --accent: #5ad6ff;
      --accent-2: #7ee0ff;
      --text: #eaf2ff;
      --sub: #b6c4e0;
    }

    body[data-theme="esportes"] {
      --panel: rgba(18, 27, 20, 0.92);
      --panel-2: rgba(26, 44, 30, 0.92);
      --accent: #7fff65;
      --accent-2: #9bff80;
      --text: #e8ffe4;
      --sub: #b9f3b2;
    }

    body[data-theme="entretenimento"] {
      --panel: rgba(36, 16, 44, 0.92);
      --panel-2: rgba(52, 21, 65, 0.92);
      --accent: #ff7af0;
      --accent-2: #ffd477;
      --text: #ffeefe;
      --sub: #f1c9ff;
    }

    /* Personalidades por tema */
    body[data-theme="jornalismo"] .gc-shell {
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: linear-gradient(135deg, rgba(15, 24, 42, 0.92), rgba(24, 36, 64, 0.96));
    }

    body[data-theme="jornalismo"] .accent-1 {
      background: linear-gradient(120deg, rgba(90, 214, 255, 0.18), transparent 60%);
    }

    body[data-theme="jornalismo"] .accent-2 {
      background: radial-gradient(circle at 90% 0%, rgba(126, 224, 255, 0.18), transparent 40%);
    }

    body[data-theme="jornalismo"] .bar {
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
    }

    body[data-theme="esportes"] .gc-shell {
      border-radius: 10px 24px 14px 24px;
      background: linear-gradient(135deg, #0f2014, #1f3b25);
      border: 1px solid rgba(127, 255, 101, 0.35);
    }

    body[data-theme="esportes"] .accent-1 {
      background: linear-gradient(140deg, rgba(0, 255, 120, 0.25), rgba(0, 180, 120, 0.05));
      clip-path: polygon(0 0, 55% 0, 45% 100%, 0 100%);
    }

    body[data-theme="esportes"] .accent-2 {
      background: linear-gradient(200deg, rgba(0, 255, 143, 0.18), transparent 60%);
      clip-path: polygon(70% 0, 100% 0, 100% 100%, 52% 100%);
      opacity: 0.8;
    }

    body[data-theme="esportes"] .bar {
      background: linear-gradient(200deg, #89ff6d, #27ff8a);
      clip-path: polygon(0 0, 100% 0, 85% 100%, 0 100%);
    }

    body[data-theme="esportes"] .content {
      padding: 18px 22px 20px 18px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.03), transparent 40%);
    }

    body[data-theme="esportes"] .type-pill {
      background: rgba(127, 255, 101, 0.14);
      border-color: rgba(127, 255, 101, 0.45);
      letter-spacing: 0.6px;
    }

    body[data-theme="entretenimento"] .gc-shell {
      border-radius: 20px;
      background: radial-gradient(circle at 15% 20%, rgba(255, 122, 240, 0.2), transparent 40%),
        linear-gradient(135deg, #2f1142, #4a1a65 60%, #2f1142);
      border: 1px solid rgba(255, 122, 240, 0.35);
    }

    body[data-theme="entretenimento"] .accent-1 {
      background: linear-gradient(120deg, rgba(255, 122, 240, 0.25), rgba(255, 212, 119, 0.12));
      clip-path: polygon(0 0, 75% 0, 60% 100%, 0 100%);
    }

    body[data-theme="entretenimento"] .accent-2 {
      background: linear-gradient(200deg, rgba(255, 212, 119, 0.24), transparent 60%);
      clip-path: polygon(40% 0, 100% 0, 100% 100%, 55% 100%);
      opacity: 0.9;
    }

    body[data-theme="entretenimento"] .bar {
      background: linear-gradient(200deg, #ff9ef8, #ff7af0 45%, #ffd477);
    }

    body[data-theme="entretenimento"] .type-pill {
      background: rgba(255, 122, 240, 0.15);
      border-color: rgba(255, 212, 119, 0.5);
      letter-spacing: 0.55px;
    }

    .gc-shell {
      background: linear-gradient(135deg, var(--panel), var(--panel-2));
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: var(--shadow);
      position: relative;
      isolation: isolate;
    }

    .glow {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 15% 20%, color-mix(in srgb, var(--accent) 24%, transparent), transparent 45%),
        radial-gradient(circle at 80% 60%, color-mix(in srgb, var(--accent-2) 30%, transparent), transparent 50%);
      filter: blur(24px);
      opacity: 0.65;
      pointer-events: none;
    }

    .accent {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.65;
    }

    .accent-1 { mix-blend-mode: screen; }
    .accent-2 { mix-blend-mode: overlay; }

    .strip {
      display: grid;
      grid-template-columns: 8px auto;
      position: relative;
    }

    .bar {
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
    }

    .content {
      padding: 18px 22px 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .title {
      font-size: 32px;
      font-weight: 850;
      letter-spacing: 0.3px;
      color: var(--text);
      white-space: nowrap;
      transform-origin: left center;
      display: inline-block;
      --fit-scale: 1;
      transform: scaleX(var(--fit-scale));
      transition: filter 0.35s ease;
    }

    .subtitle {
      font-size: 19px;
      font-weight: 650;
      color: var(--sub);
      letter-spacing: 0.2px;
      white-space: nowrap;
      transform-origin: left center;
      display: inline-block;
      --fit-scale: 1;
      transform: scaleX(var(--fit-scale));
      transition: filter 0.35s ease;
    }

    .text-refresh {
      animation: textGlow 0.9s ease, textSweep 0.95s ease;
      background-image: linear-gradient(120deg, rgba(255,255,255,0.18), rgba(255,255,255,0));
      background-repeat: no-repeat;
      background-size: 0% 100%;
      background-position: 0 50%;
      -webkit-background-clip: text;
      color: var(--text);
    }

    @keyframes textGlow {
      0% { filter: drop-shadow(0 0 0px rgba(255,255,255,0)); }
      45% { filter: drop-shadow(0 6px 18px rgba(255,255,255,0.25)) brightness(1.25); }
      100% { filter: drop-shadow(0 0 0px rgba(255,255,255,0)); }
    }

    @keyframes textSweep {
      0% { background-size: 0% 100%; background-position: 0 50%; }
      50% { background-size: 120% 100%; background-position: 100% 50%; }
      100% { background-size: 0% 100%; background-position: 100% 50%; }
    }

    .meta {
      margin-top: 4px;
      display: flex;
      gap: 12px;
      align-items: center;
      color: var(--sub);
      font-size: 13px;
      letter-spacing: 0.2px;
    }

    .clock {
      padding: 7px 12px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-weight: 700;
      min-width: 86px;
      text-align: center;
      letter-spacing: 0.6px;
    }

    .type-pill {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
      font-weight: 700;
      letter-spacing: 0.3px;
    }
  </style>
</head>
<body data-theme="jornalismo" data-backdrop="transparent">
  <div class="layer">
    <div id="gcFrame" class="anim-slide">
      <div class="gc-shell">
        <div class="glow"></div>
        <div class="accent accent-1"></div>
        <div class="accent accent-2"></div>
        <div class="strip">
          <div class="bar"></div>
          <div class="content">
            <div class="title" id="title">Título do GC</div>
            <div class="subtitle" id="subtitle">Subtítulo</div>
            <div class="meta">
              <div class="type-pill" id="typePill">JORNALISMO</div>
              <div class="clock" id="clock">00:00</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Utilidade para medir e comprimir texto sem quebra de linha
    function fitText(el, limitPx) {
      if (!el) return;
      el.style.setProperty('--fit-scale', 1);
      const available = Math.max(1, limitPx || el.offsetWidth || 1);
      // Usa scrollWidth para descobrir a largura real do texto
      const width = el.scrollWidth;
      const scale = width > available ? available / width : 1;
      el.style.setProperty('--fit-scale', scale);
    }

    const state = {
      theme: 'jornalismo',
      title: 'Título do GC',
      subtitle: 'Subtítulo',
      show: false,
      clock: true,
      backdrop: 'transparent',
      animation: 'slide',
      maxWidth: 960,
      textLimit: 1000,
      textPulse: Date.now()
    };

    const els = {
      frame: document.getElementById('gcFrame'),
      title: document.getElementById('title'),
      subtitle: document.getElementById('subtitle'),
      typePill: document.getElementById('typePill'),
      clock: document.getElementById('clock')
    };

    // Configura canal de comunicação
    let channel = null;
    try {
      if ('BroadcastChannel' in window) {
        channel = new BroadcastChannel('gc-sync');
      }
    } catch (err) {
      channel = null;
    }

    function applyTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      const label = theme === 'jornalismo' ? 'JORNALISMO' : theme === 'esportes' ? 'ESPORTES' : 'ENTRETENIMENTO';
      els.typePill.textContent = label;
    }

    function applyBackdrop(value) {
      document.body.setAttribute('data-backdrop', value);
    }

    function applyAnimation(name) {
      const cls = `anim-${name}`;
      els.frame.classList.remove('anim-slide', 'anim-fade', 'anim-pop');
      els.frame.classList.add(cls);
    }

    function applySize(maxWidth) {
      els.frame.style.maxWidth = `${maxWidth || 960}px`;
    }

    function applyTexts(limit) {
      fitText(els.title, limit);
      fitText(els.subtitle, limit);
    }

    function triggerTextAnimation() {
      [els.title, els.subtitle].forEach((node) => {
        node.classList.remove('text-refresh');
        // reflow to restart animation
        void node.offsetWidth;
        node.classList.add('text-refresh');
      });
    }

    function setVisibility(show) {
      const frame = els.frame;
      frame.classList.remove('hiding');
      if (show) {
        frame.classList.add('visible');
      } else {
        frame.classList.add('hiding');
        setTimeout(() => frame.classList.remove('visible'), 420);
      }
    }

    function updateClock() {
      if (!state.clock) {
        els.clock.style.display = 'none';
        return;
      }
      els.clock.style.display = 'inline-flex';
      const now = new Date();
      const pad = (n) => String(n).padStart(2, '0');
      els.clock.textContent = `${pad(now.getHours())}:${pad(now.getMinutes())}`;
    }

    function applyState(update = {}) {
      const previousPulse = state.textPulse;
      Object.assign(state, update);
      els.title.textContent = state.title || ' ';
      els.subtitle.textContent = state.subtitle || ' ';
      applyTheme(state.theme);
      applyBackdrop(state.backdrop);
      applyAnimation(state.animation);
      applySize(state.maxWidth);
      applyTexts(state.textLimit);
      setVisibility(state.show);
      updateClock();
      if (update.title !== undefined || update.subtitle !== undefined || previousPulse !== state.textPulse) {
        triggerTextAnimation();
      }
    }

    function sendReady() {
      const heartbeat = { ready: true, ts: Date.now() };
      if (channel) channel.postMessage(heartbeat);
      try {
        localStorage.setItem('gc-sync-reply', JSON.stringify(heartbeat));
      } catch (err) {
        /* ignore */
      }
    }

    // Comunicação: recebe payloads do controlador
    const handleMessage = (payload) => {
      if (!payload) return;
      applyState(payload);
      // Responde para o controlador saber que estamos vivos
      sendReady();
    };

    if (channel) {
      channel.addEventListener('message', (ev) => handleMessage(ev.data));
    }

    window.addEventListener('storage', (e) => {
      if (e.key === 'gc-sync') {
        try {
          const data = JSON.parse(e.newValue || '{}');
          handleMessage(data);
        } catch (err) {
          /* ignore */
        }
      }
    });

    // Clock interval
    setInterval(updateClock, 1000);

    // Tenta aplicar último estado salvo
    try {
      const cached = localStorage.getItem('gc-sync');
      if (cached) handleMessage(JSON.parse(cached));
    } catch (err) {
      /* ignore */
    }

    // Anuncia presença mesmo sem receber comandos
    sendReady();
  </script>
</body>
</html>
